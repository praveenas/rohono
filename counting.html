<!DOCTYPE HTML>
<html>
<head>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
          integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
          crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"
          integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
          integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
  <style>

    .block, .hint {
      width: 59.7917px;
      margin: 2px;
      border: 1px solid #001f3f;
      border-radius: 10px;
      font-weight: bold;
    }

    .times {
      width: 159.7917px;
      background-color: #7F86FF;
      color: white;
    }
    .hint {
      background-color: #FFA37F;
      color: #CCF1FF;
    }
    .dragblock {
      width: 59.7917px;
      margin: 2px;
      border: 1px dotted #001f3f;
      border-radius: 10px;
      font-weight: bold;
    }

    .counting{
      background-color:#7FDBFF;
      padding: 50px;
    }

    .cover-container {
      max-width: 60em;
    }

    .cover-heading {
      font-size: 5.00rem;
    }

    #playagain {
      display: none;
      margin: 10px;
    }

    .btn-lg {
      width: 100%;
      background-color: #7F86FF;
      color: #fff;
    }
  </style>
</head>
<script>
var synth = window.speechSynthesis;
$(function() {
  function speak(text) {
    var utterThis = new SpeechSynthesisUtterance(text);
    if (synth.speaking) {
        console.error('speechSynthesis.speaking');
        return;
    }
    utterThis.onend = function(event) {
      console.log('SpeechSynthesisUtterance.onend');
    }
    utterThis.onerror = function(event) {
      console.error('SpeechSynthesisUtterance.onerror');
    }
    utterThis.rate = 0.8;
    synth.speak(utterThis);
  }

   $('#playagain').click(function() {
        play();
   });

  function play() {

    $("#playagain").hide();
    $("#dropContainer").html("<div></div>");
    $("#dragContainer").html("<div></div>");
    $("#congratulations").html("");

    var url = new URL(window.location);
    var countByParam = url.searchParams.get("countBy");
    var shuffleParam = url.searchParams.get("shuffle");

    var countBy = countByParam == null ? Math.min(Math.floor(Math.random() * 10) + 1, 10) : countByParam;
    var max = countBy * 10;

    $("#countBy").html(countBy);

    var j;
    for (j = 1; j < (max / countBy + 1); j++) {
      var dropRow = "<div id='dropRow" + j + "' class='row'></div>";
      $("#dropContainer").append(dropRow);

    }

    var i;
    var dragArray = [];
    for (i = 1; i < max + 1; i++) {

      var text = i % countBy == 0 ? "?" : i;
      var clazz = i % countBy == 0 ? "alert-secondary" : "alert-light";

      var dropText = "<div id='drop" + i + "' class='block text-center alert " + clazz + "'>" + text + "</div>"

      $("#dropRow" + Math.ceil(i / countBy)).append(dropText);

      if (i % countBy == 0) {

        $("#dropRow" + Math.ceil(i / countBy)).append("<div id='drop" + i + "' class='times block text-center alert alert-warning'>  " + countBy + " * " + Math.ceil(i / countBy) + "</div>");

        $("#drop" + i).droppable({
          accept: "#" + i,
          activeClass: "hint",
          hoverClass: "hint",

          addClasses: "false",
          drop: function(event, ui) {
            var index = event.target.id.replace("drop", "");
            $("#" + event.target.id).html(index).addClass("hint");
            $("#" + index).hide();
            speak(countBy + " times " + (index / countBy) + " is " + index);
            if ($('.dragblock:visible').length == 0) {
              $("#dragcontent").html('<div><h2>CONGRATULATIONS!</div>');
              $("#playagain").show();
            }
          },
          deactivate: function(event, ui) {
            var index = event.target.id.replace("drop", "");
            if ($("#" + event.target.id).html() == index) {
              $("#" + event.target.id).addClass("hint");
            }

          }
        });
        dragArray.push(i);
      }

    }

    if (shuffleParam == "true") {
      dragArray = shuffle(dragArray);
    }

    for (y = 0; y < dragArray.length; y++) {
      var rowId = Math.ceil(dragArray[y] / countBy);
      var dragText = "<div id='" + dragArray[y] + "' class='drag dragblock text-center alert alert-light'>" + dragArray[y] + "</div>"
      var dragRow = "<div id='dragRow" + rowId + "' class='row'></div>";
      $("#dragContainer").append(dragRow);
      $("#dragRow" + rowId).append(dragText);
      $("#" + dragArray[y]).draggable({
        cursor: "crosshair",
        revert: 'invalid',
        start: function(event, ui) {
          speak(event.target.id);
        }
      });
    }
  }

  function shuffle(array) {
    var currentIndex = array.length,
      temporaryValue, randomIndex;

    // While there remain elements to shuffle...
    while (0 !== currentIndex) {

      // Pick a remaining element...
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex -= 1;

      // And swap it with the current element.
      temporaryValue = array[currentIndex];
      array[currentIndex] = array[randomIndex];
      array[randomIndex] = temporaryValue;
    }

    return array;
  }

  play();

  $('#sd').click(function() {
    speak("Count by " + $("#countBy").html() + "'s");
  });
})
</script>
<body style="background-color:#7FDBFF">


<div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
    <main role="main" class="inner cover">
    <div class="row">
      <h1> COUNT BY <span id="countBy"></span>'s</h1>
        <div id="sd" class="row">
            <h1 class="cover-heading" id="word"></h1>
            <svg class="bi bi-volume-up" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M6.717 3.55A.5.5 0 017 4v8a.5.5 0 01-.812.39L3.825 10.5H1.5A.5.5 0 011 10V6a.5.5 0 01.5-.5h2.325l2.363-1.89a.5.5 0 01.529-.06zM6 5.04L4.312 6.39A.5.5 0 014 6.5H2v3h2a.5.5 0 01.312.11L6 10.96V5.04z" clip-rule="evenodd"></path>
                <path d="M11.536 14.01A8.473 8.473 0 0014.026 8a8.473 8.473 0 00-2.49-6.01l-.708.707A7.476 7.476 0 0113.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"></path>
                <path d="M10.121 12.596A6.48 6.48 0 0012.025 8a6.48 6.48 0 00-1.904-4.596l-.707.707A5.483 5.483 0 0111.025 8a5.483 5.483 0 01-1.61 3.89l.706.706z"></path>
                <path d="M8.707 11.182A4.486 4.486 0 0010.025 8a4.486 4.486 0 00-1.318-3.182L8 5.525A3.489 3.489 0 019.025 8 3.49 3.49 0 018 10.475l.707.707z"></path>
            </svg>
        </div>
    </div>

    <div class="row">
      <button id="playagain" type="button" class="btn btn-lg">
          <div class="cover-heading"> Play Again</div>
      </button>
    </div>
    <div class="row">
      <div class="col-md-auto">
        <div id="dropContainer">
        </div>
      </div>
      <div class="col-sm-auto" style="margin-left: 50px;">
        <div id="dragContainer">
        </div>
      </div>
    </div>
    </main>
</div>

</body>
</html>
