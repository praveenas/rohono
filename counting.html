<!DOCTYPE HTML>
<html>
<head>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
          integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
          crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"
          integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
          integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
  <script src='//vws.responsivevoice.com/v/e?key=7xDYr79A'></script>
  <script src="http://code.responsivevoice.org/responsivevoice.js"></script>
  <style>

    .block, .hint {
      width: 59.7917px;
      margin: 2px;
      border: 1px solid #001f3f;
      border-radius: 10px;
      font-weight: bold;
    }

    .hint {
      width: 159.7917px;
    }

    .dragblock {
      width: 59.7917px;
      margin: 2px;
      border: 1px dotted #001f3f;
      border-radius: 10px;
      font-weight: bold;
    }

    #dropContainer{
      //width: 700px;
      //border: 1px solid red;
    }

    #dragContainer{
      //width: 200px;
      //border: 1px solid red;
    }

    .counting{
      background-color:#7FDBFF;
      //font-family: "proxima-nova-soft", "Proxima Nova Soft", Helvetica, Arial, sans-serif;
      padding: 50px;
    }

    #playagain{
       display: none;
      // width: 100px;
       margin-top: 20px;
    }
    .btn-lg{
      width:100%
    }
    .container1{
      margin: 10px;
    }




  </style>
</head>
<script>

        $(function () {


          var url = new URL(window.location);
          var countByParam = url.searchParams.get("countBy");
          var shuffleParam = url.searchParams.get("shuffle");

          var countBy = countByParam == null ? Math.min(Math.floor(Math.random() * 10)+1,10): countByParam;
          var max = countBy * 10;

          $("#countBy").html(countBy);

          var audioElement = document.createElement('audio');
          audioElement.setAttribute('src', 'http://soundbible.com/mp3/Cheering-SoundBible.com-1115515042.mp3');

          var j;
          for(j=1; j < (max/countBy + 1); j++){
           var dropRow = "<div id='dropRow"+j+"' class='row'></div>";
           $("#dropContainer").append(dropRow);

          }

          var i;
          var dragArray=[];
          for (i = 1; i < max+1; i++) {

            $('#playagain').click(function() {
                location.reload();
            });
            var text = i%countBy ==0 ? "?" : i ;
            var clazz =  i%countBy == 0 ? "alert-secondary" : "alert-light";

            var dropText = "<div id='drop"+i+"' class='block text-center alert "+clazz+"'>"+text+"</div>"

            $("#dropRow"+Math.ceil(i/countBy)).append(dropText);

            if(i%countBy == 0){

              $("#dropRow"+Math.ceil(i/countBy)).append("<div id='drop"+i+"' class='hint block text-center alert alert-warning'>  "+countBy+" * "+Math.ceil(i/countBy)+"</div>" );

              $("#drop"+i).droppable({
                  accept: "#"+i,
                  activeClass: "alert-success",
                  hoverClass: "alert-success",

                  addClasses: "false",
                  drop: function (event, ui) {
                      var index = event.target.id.replace("drop","");
                      $("#"+event.target.id).html(index).addClass("alert-success");
                      $("#"+index).hide();
                      if($('.dragblock:visible').length == 0) {
                        $("#dragcontent").html('<div><h2>CONGRATULATIONS!</div>');
                         audioElement.play();
                         $("#playagain").show();
                      }
                  },
                  deactivate: function(event,ui){
                    var index = event.target.id.replace("drop","");
                    if($("#"+event.target.id).html() == index){
                      $("#"+event.target.id).addClass("alert-success");
                    }

                  }
              });
              dragArray.push(i);
            }

          }

          if(shuffleParam == "true"){
            dragArray = shuffle(dragArray);
          }

          for(y=0; y < dragArray.length; y++ ) {
           var rowId = Math.ceil(dragArray[y]/countBy);
           var dragText = "<div id='"+dragArray[y]+"' class='drag dragblock text-center alert alert-light'>"+dragArray[y]+"</div>"
           var dragRow = "<div id='dragRow"+rowId+"' class='row'></div>";
           $("#dragContainer").append(dragRow);
           $("#dragRow"+ rowId).append(dragText);
           $("#"+dragArray[y]).draggable({
              cursor: "crosshair",
              revert: 'invalid',
              start: function(event, ui){
                 responsiveVoice.speak(event.target.id);
              }
           });
          }

          function shuffle(array) {
            var currentIndex = array.length, temporaryValue, randomIndex;

            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

              // Pick a remaining element...
              randomIndex = Math.floor(Math.random() * currentIndex);
              currentIndex -= 1;

              // And swap it with the current element.
              temporaryValue = array[currentIndex];
              array[currentIndex] = array[randomIndex];
              array[randomIndex] = temporaryValue;
            }

            return array;
          }

        })


</script>
<body style="background-color:#7FDBFF">

<div class="counting">
  <div class="container1">
    <div class="row">
      <h1> COUNT BY <span id="countBy"></span>'s</h1>
    </div>

    <div>
      <button id="playagain" type="button" class="btn btn-success btn-lg">Play Again</button>
    </div>
    <div class="row">
      <div class="col-md-auto">
        <div id="dropContainer">
        </div>
      </div>
      <div class="col-sm-auto" style="margin-left: 50px;">
        <div id="dragContainer">
        </div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
